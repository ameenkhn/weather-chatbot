<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weather Prediction Chatbot</title>
  <style>
    /* (Your original CSS preserved) */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100vh; display: flex; align-items: center; justify-content: center; }
    .chat-container { background: rgba(255, 255, 255, 0.95); border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); width: 90%; max-width: 800px; height: 80vh; display: flex; flex-direction: column; overflow: hidden; backdrop-filter: blur(10px); }
    .chat-header { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; text-align: center; font-size: 24px; font-weight: bold; }
    .chat-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
    .message { max-width: 80%; padding: 15px 20px; border-radius: 20px; animation: fadeIn 0.3s ease-in; }
    .user-message { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; align-self: flex-end; border-bottom-right-radius: 5px; }
    .bot-message { background: #f1f3f4; color: #333; align-self: flex-start; border-bottom-left-radius: 5px; border: 1px solid #e0e0e0; }
    .tools-used { font-size: 12px; color: #666; margin-top: 5px; font-style: italic; }
    .chat-input-container { padding: 20px; background: white; border-top: 1px solid #e0e0e0; display: flex; gap: 10px; }
    .chat-input { flex: 1; padding: 15px 20px; border: 2px solid #e0e0e0; border-radius: 25px; font-size: 16px; outline: none; transition: border-color 0.3s; }
    .chat-input:focus { border-color: #4facfe; }
    .send-button { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: transform 0.2s; }
    .send-button:hover { transform: scale(1.1); }
    .send-button:disabled { opacity: 0.6; cursor: not-allowed; }
    .loading { display: flex; align-items: center; gap: 5px; color: #666; font-style: italic; }
    .typing-indicator { display: inline-flex; gap: 2px; }
    .typing-indicator span { width: 6px; height: 6px; background: #4facfe; border-radius: 50%; animation: typing 1.4s infinite; }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .clear-button { background: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-size: 14px; transition: background 0.3s; }
    .clear-button:hover { background: #ff5252; }
    .welcome-message { text-align: center; color: #666; font-style: italic; margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 15px; border: 1px dashed #ccc; }
    @media (max-width: 768px) { .chat-container { width: 95%; height: 90vh; } .message { max-width: 90%; } }
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">
      üå§Ô∏è Weather Prediction Chatbot
      <div style="font-size: 14px; margin-top: 5px; opacity: 0.9;">
        Powered by AI agents with weather tools
      </div>
    </div>

    <div class="chat-messages" id="chatMessages">
      <div class="welcome-message">
        <strong>Welcome to the Weather Chatbot!</strong><br>
        I can help you with weather forecasts, time zones, calculations, and more.<br>
        Try asking: "What's the weather in New York?" or "Convert 25¬∞C to Fahrenheit"
      </div>
    </div>

    <div class="chat-input-container">
      <input type="text" class="chat-input" id="chatInput"
             placeholder="Ask me about weather, time zones, or calculations..."
             onkeypress="handleKeyPress(event)">
      <button class="send-button" id="sendButton" onclick="sendMessage()">‚û§</button>
      <button class="clear-button" onclick="clearChat()">Clear</button>
    </div>
  </div>

  <script>
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendButton = document.getElementById('sendButton');
    const sessionId = 'user-' + Math.random().toString(36).substr(2, 9);

    function handleKeyPress(event) {
      if (event.key === 'Enter') sendMessage();
    }

    async function sendMessage() {
      const message = chatInput.value.trim();
      if (!message) return;

      chatInput.disabled = true;
      sendButton.disabled = true;

      addMessage(message, 'user');
      chatInput.value = '';

      const typingDiv = addTypingIndicator();

      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message, session_id: sessionId })
        });
        const data = await res.json();
        typingDiv.remove();

        if (res.ok) {
          addMessage(data.response, 'bot', data.tools_used);
        } else {
          addMessage('Sorry, I encountered an error. Please try again.', 'bot');
        }
      } catch (e) {
        typingDiv.remove();
        addMessage('Sorry, I could not connect to the server. Please try again.', 'bot');
      } finally {
        chatInput.disabled = false;
        sendButton.disabled = false;
        chatInput.focus();
      }
    }

    function addMessage(text, sender, toolsUsed = []) {
      const div = document.createElement('div');
      div.className = `message ${sender}-message`;
      let content = `<div>${text}</div>`;
      if (toolsUsed && toolsUsed.length > 0) {
        content += `<div class="tools-used">üîß Tools used: ${toolsUsed.join(', ')}</div>`;
      }
      div.innerHTML = content;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function addTypingIndicator() {
      const div = document.createElement('div');
      div.className = 'message bot-message loading';
      div.innerHTML = `
        <div>Thinking...</div>
        <div class="typing-indicator"><span></span><span></span><span></span></div>
      `;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      return div;
    }

    async function clearChat() {
      try {
        await fetch(`/chat/history/${sessionId}`, { method: 'DELETE' });
        chatMessages.innerHTML = `
          <div class="welcome-message">
            <strong>Chat cleared!</strong><br>
            Ask me anything about weather, time zones, or calculations.
          </div>
        `;
      } catch (e) { console.error('Error clearing chat:', e); }
    }

    window.onload = () => chatInput.focus();
  </script>
</body>
</html>